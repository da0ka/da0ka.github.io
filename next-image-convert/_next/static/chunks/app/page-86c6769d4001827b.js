(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{390:(e,a,r)=>{Promise.resolve().then(r.bind(r,3155))},3155:(e,a,r)=>{"use strict";r.r(a),r.d(a,{default:()=>x});var t=r(4687),n=r(5924);let l=e=>new Promise(a=>{e.addEventListener("message",()=>{a(e)},{once:!0})}),s=(e,a,...r)=>new Promise((t,n)=>{let l=async a=>{let{data:s}=a;switch(s.type){case"callback":let i=r[s.payload.index](s.payload.value);e.postMessage({type:"callback_result",payload:{id:s.payload.id,result:await i}});break;case"result":e.removeEventListener("message",l),t(s.payload);break;case"error":e.removeEventListener("message",l),n(s.payload)}};e.addEventListener("message",l),e.postMessage({type:"function",payload:{name:a,value:r.map(e=>"function"!=typeof e&&e),callback:r.map(e=>"function"==typeof e)}})}),{execute:i,setLimit:o,close:c,waitAll:d,waitReady:u,launchWorker:m}=((e,a=4)=>{let r=Array(a).fill(void 0).map(()=>({})),t=[],n=!1,i=async()=>{for(;;){let a=r.find(({resultResolver:e})=>!e);if(a){if(a.resultResolver=Promise.withResolvers(),!a.worker){let r=e(),t=r instanceof Worker?r:new Worker(r);a.worker=await l(t)}return a}await Promise.race(r.map(({resultResolver:e})=>e?.promise))}};return{execute:async(e,...a)=>{let r=await i(),{resultResolver:t}=r;if(!t)throw Error("Unexpected error");return s(r.worker,e,...a).then(t.resolve).catch(t.reject).finally(()=>{r.resultResolver=void 0}),t.promise},waitAll:async()=>{for(;r.find(({resultResolver:e})=>e);)await Promise.all(r.flatMap(({resultResolver:e})=>e?[e.promise]:[]))},waitReady:async(e=1)=>{let a=Promise.withResolvers();return t.push(a),(async()=>{if(!n){n=!0;do{let a=r.flatMap(({resultResolver:e})=>e?[e.promise]:[]);r.length===a.length&&await Promise.race(a),t.shift()?.resolve(),e?await new Promise(a=>setTimeout(a,e)):await Promise.resolve()}while(t.length);n=!1}})(),a.promise},close:()=>{for(let{worker:e}of r)e?.terminate()},setLimit:e=>{r.forEach(e=>e.worker?.terminate()),r=Array(e).fill(void 0).map(()=>({}))},launchWorker:async()=>Promise.all(r.map(async a=>{if(!a.worker){let r=e(),t=r instanceof Worker?r:new Worker(r);a.worker=await l(t)}}))}})(()=>new Worker(r.tu(new URL(r.p+r.u(476),r.b))),5),p=async e=>i("optimizeImageExt",e);o(8),m();let h=function(){for(var e=arguments.length,a=Array(e),r=0;r<e;r++)a[r]=arguments[r];return a.reduce((e,a,r)=>e+(a?(r?" ":"")+a:""),"")},g=()=>{let[e,a]=(0,n.useState)(0);return(0,n.useEffect)(()=>{let e=setInterval(()=>a(e=>e+1),100);return()=>clearInterval(e)},[]),(0,t.jsxs)("div",{children:[e," ← Test that the UI is working without being blocked during conversion."]})},f=e=>{let{onFiles:a}=e,r=(0,n.useRef)(null),[l,s]=(0,n.useState)(!1);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:h("w-64 h-32 border-dashed border flex justify-center items-center cursor-pointer select-none m-2 rounded-4xl p-4",l&&"outline outline-blue-400"),onDragOver:e=>{e.preventDefault(),e.stopPropagation()},onDragEnter:e=>{e.preventDefault(),e.stopPropagation()},onDoubleClick:()=>{var e;null===(e=r.current)||void 0===e||e.click()},onClick:()=>{var e;null===(e=r.current)||void 0===e||e.focus()},onDrop:e=>{a(Array.from(e.dataTransfer.files)),e.preventDefault()},children:"Drop here, copy and paste or double-click to select the file."}),(0,t.jsx)("input",{ref:r,className:"absolute size-0",type:"file",multiple:!0,accept:".jpg,.png,.gif,.svg,.avif,.webp",onFocus:()=>s(!0),onBlur:()=>s(!1),onPaste:e=>{e.preventDefault(),a(Array.from(e.clipboardData.files))},onChange:e=>{e.preventDefault(),e.currentTarget.files&&a(Array.from(e.currentTarget.files))}})]})},v=["none","avif","webp","jpeg","png"],b=e=>{let{file:a,format:r,quality:l,size:s,speed:i,onFinished:o}=e,[c,d]=(0,n.useState)(),[m,h]=(0,n.useState)(null),g=(0,n.useRef)({}).current;g.isInit||(g.isInit=!0,(async()=>{h(null),await u();let e=await a.arrayBuffer(),t=performance.now(),n=await p({image:e,format:r,quality:l,speed:i,width:s[0]||void 0,height:s[1]||void 0}),c=performance.now()-t;d(c),h(n),n&&(null==o||o({image:n,format:r,speed:i,quality:l,time:c}))})());let f=(0,n.useMemo)(()=>m&&URL.createObjectURL(new Blob([m.data],{type:"none"===r?a.type:"image/".concat(r)})),[m]),v="none"===r?a.name:a.name.replace(/\.\w+$/,".".concat(r));return(0,t.jsxs)("div",{className:"border border-gray-300 rounded-4 overflow-hidden relative w-64 h-64 grid",children:[void 0===m&&(0,t.jsx)("div",{children:"Error"}),f&&m&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("a",{target:"_blank",href:f,children:(0,t.jsx)("img",{className:"flex-1 object-contain block overflow-hidden",src:f})}),(0,t.jsxs)("div",{className:"bg-white/80 w-full z-10 text-right p-0 absolute bottom-0 font-bold",children:[(0,t.jsx)("div",{children:v}),(0,t.jsxs)("div",{children:[null==c?void 0:c.toLocaleString(),"ms"]}),(0,t.jsxs)("div",{children:["none"!==r?"Optimize":"Original",":"," ",m.width.toLocaleString(),"x",m.height.toLocaleString()," -"," ",Math.ceil(m.data.length/1024).toLocaleString(),"KB"]})]})]}),null===m&&(0,t.jsx)("div",{className:"m-auto animate-spin h-10 w-10 border-4 border-blue-600 rounded-full border-t-transparent"})]})},x=()=>{let[e,a]=(0,n.useState)([]),[r,l]=(0,n.useState)(80),[s,i]=(0,n.useState)(6),[c,d]=(0,n.useState)([0,0]),[u,p]=(0,n.useState)(10),[h,x]=(0,n.useState)(v),[w,y]=(0,n.useState)([]),j=(0,n.useMemo)(()=>w.join("\n"),[w]);return(0,t.jsxs)("div",{className:"p-4",children:[(0,t.jsx)("div",{children:(0,t.jsx)("a",{className:"text-blue-600 hover:underline",href:"https://github.com/SoraKumo001/wasm-image-optimization-samples/tree/master/next-image-convert",children:"Source code"})}),"Timer indicating that front-end processing has not stopped.",(0,t.jsx)(g,{}),(0,t.jsxs)("div",{className:"flex",children:[(0,t.jsx)(f,{onFiles:e=>a(a=>[...a,...e])}),(0,t.jsx)("textarea",{className:"border flex-1 border-gray-400 p-2 rounded bg-gray-50 font-mono",value:j,readOnly:!0})]}),(0,t.jsx)("button",{className:"text-blue-700 hover:text-white border border-blue-500 hover:bg-blue-600 rounded-lg text-sm px-5 py-2.5 text-center me-2 mb-2 cursor-pointer",onClick:()=>{a([]),y([])},children:"Clear"}),(0,t.jsxs)("label",{className:"flex gap-2 items-center",children:[(0,t.jsx)("input",{type:"number",className:"border border-gray-300 rounded-4 p-1",value:c[0],onChange:e=>d(a=>[Math.max(0,Number(e.target.value)),a[1]])}),"Width(0:Original)"]}),(0,t.jsxs)("label",{className:"flex gap-2 items-center",children:[(0,t.jsx)("input",{type:"number",className:"border border-gray-300 rounded-4 p-1",value:c[1],onChange:e=>d(a=>[a[0],Math.max(0,Number(e.target.value))])}),"Height(0:Original)"]}),(0,t.jsxs)("label",{className:"flex gap-2 items-center",children:[(0,t.jsx)("input",{type:"number",className:"border border-gray-300 rounded-4 p-1",value:s,onChange:e=>i(Math.min(10,Math.max(0,Number(e.target.value))))}),"Speed(0-10,Slower-Faster): Avif"]}),(0,t.jsxs)("label",{className:"flex gap-2 items-center",children:[(0,t.jsx)("input",{type:"number",className:"border border-gray-300 rounded-4 p-1",value:r,onChange:e=>l(Math.min(100,Math.max(0,Number(e.target.value))))}),"Quality(0-100): Avif, Jpeg, WebP"]}),(0,t.jsxs)("label",{className:"flex gap-2 items-center",children:[(0,t.jsx)("input",{type:"number",className:"border border-gray-300 rounded-4 p-1",value:u,onChange:e=>{let a=Math.max(1,Number(e.target.value));o(a),p(a),m()}}),"Web Workers(1-)"]}),(0,t.jsx)("div",{className:"flex gap-2",children:v.map(e=>(0,t.jsxs)("label",{className:"flex gap-1 ",children:[(0,t.jsx)("input",{type:"checkbox",checked:h.includes(e),onChange:a=>{a.currentTarget.checked?x(a=>[...a,e]):x(a=>a.filter(a=>a!==e))}}),e]},e))}),(0,t.jsx)("hr",{className:"m-4"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-4",children:e.flatMap((e,a)=>(0,t.jsx)("div",{className:"flex flex-wrap gap-4",children:v.filter(e=>h.includes(e)).map((n,l)=>(0,t.jsx)(b,{file:e,format:n,quality:r,speed:s,size:c,onFinished:t=>{y(i=>[...i,"".concat(a,"-").concat(l,"-").concat(n.padEnd(4)," ").concat(e.name,"(").concat(t.image.originalWidth,"x").concat(t.image.originalHeight,") (").concat(t.image.width,"x").concat(t.image.height,") Speed:").concat(s," Quality:").concat(r," ").concat(Math.ceil(t.image.data.length/1024).toLocaleString().padStart(8),"KB ").concat(t.time.toLocaleString(void 0,{minimumFractionDigits:1}).padStart(8),"ms")].sort((e,a)=>e<a?-1:1))}},n))},a))})]})}}},e=>{var a=a=>e(e.s=a);e.O(0,[238,908,358],()=>a(390)),_N_E=e.O()}]);